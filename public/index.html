<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apple Music - Login</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="logo">
        <svg viewBox="0 0 24 24" width="60" height="60" fill="#FA233B">
          <path d="M23.997 6.124a9.23 9.23 0 0 0-.24-2.19 5.895 5.895 0 0 0-1.003-1.9 5.818 5.818 0 0 0-1.903-1.3A8.972 8.972 0 0 0 18.686.256 62.47 62.47 0 0 0 12.001 0h-.003a61.63 61.63 0 0 0-6.689.26 8.851 8.851 0 0 0-2.16.483 5.818 5.818 0 0 0-1.903 1.3 5.895 5.895 0 0 0-1.003 1.9c-.209.622-.338 1.37-.387 2.19a62.366 62.366 0 0 0-.147 3.87v3.994a62.64 62.64 0 0 0 .147 3.87c.049.82.178 1.568.387 2.19a5.895 5.895 0 0 0 1.003 1.9 5.818 5.818 0 0 0 1.903 1.3 8.971 8.971 0 0 0 2.16.483c2.164.171 4.395.27 6.686.26h.003a62.56 62.56 0 0 0 6.686-.26 8.972 8.972 0 0 0 2.163-.483 5.818 5.818 0 0 0 1.903-1.3 5.895 5.895 0 0 0 1.003-1.9c.209-.622.338-1.37.387-2.19a62.37 62.37 0 0 0 .147-3.87V9.994a63.065 63.065 0 0 0-.147-3.87zm-10.51 12.39a.85.85 0 0 1-.447.75c-.15.09-.323.135-.497.135a1.182 1.182 0 0 1-.405-.073 17.737 17.737 0 0 1-3.49-1.78 18.314 18.314 0 0 1-2.915-2.395 18.32 18.32 0 0 1-2.395-2.915A17.783 17.783 0 0 1 1.56 8.746a.992.992 0 0 1 .062-.902.85.85 0 0 1 .75-.447h2.138c.286 0 .548.135.716.367.171.238.21.54.103.811l-.001.003a10.39 10.39 0 0 0-.67 3.073c.002.193.077.377.21.518a.67.67 0 0 0 .505.218h.01a.762.762 0 0 0 .54-.235c.304-.32.585-.66.84-1.018.404-.567.806-1.196 1.135-1.9a6.24 6.24 0 0 0 .46-1.23l.002-.01a1.118 1.118 0 0 1 .288-.535c.166-.179.395-.295.642-.32l.025-.002c.063-.005.126-.007.19-.007h2.088c.303 0 .587.147.762.394.178.253.212.573.092.855l-.002.004a12.43 12.43 0 0 1-1.136 2.065c-.348.52-.734 1.02-1.151 1.493a10.63 10.63 0 0 0-.843 1.118.734.734 0 0 0-.09.636c.065.226.219.416.427.526.396.21.77.463 1.112.757.454.39.858.836 1.202 1.327.37.528.683 1.096.932 1.696a.99.99 0 0 1 .055.424z"/>
        </svg>
      </div>
      <h1>Apple Music</h1>
      <p class="subtitle">Sign in to sync your listening profile</p>
      
      <!-- Initial Choice Section -->
      <div id="choice-section">
        <p id="loading-text" class="loading">Loading...</p>
        <div id="choice-buttons" style="display: none;">
          <button id="new-login-btn" class="btn btn-primary">
            <span class="btn-icon">ğŸµ</span>
            New Login
          </button>
          <div class="divider">
            <span>or</span>
          </div>
          <button id="existing-users-btn" class="btn btn-secondary">
            <span class="btn-icon">ğŸ‘¥</span>
            View Existing Users
          </button>
        </div>
      </div>

      <!-- Existing Users List Section -->
      <div id="existing-users-section" style="display: none;">
        <div class="section-header">
          <h3>ğŸ‘¥ Existing Users</h3>
          <button id="back-to-choice-btn" class="btn btn-small btn-outline">
            <span class="btn-icon">â†</span> Back
          </button>
        </div>
        <div id="users-list" class="users-list"></div>
        <div id="no-users-message" class="info-card" style="display: none;">
          <p>No users found. Please login first!</p>
        </div>
      </div>

      <!-- Auth Section (for new login) -->
      <div id="auth-section" style="display: none;">
        <div class="section-header">
          <button id="back-from-login-btn" class="btn btn-small btn-outline">
            <span class="btn-icon">â†</span> Back
          </button>
        </div>
        <button id="login-btn" class="btn btn-primary" disabled>
          <span class="btn-icon">ğŸµ</span>
          Sign in with Apple Music
        </button>
        <p id="musickit-loading-text" class="loading">Loading MusicKit...</p>
      </div>

      <!-- Full Name Input Section -->
      <div id="fullname-section" style="display: none;">
        <div class="user-info">
          <div class="avatar">ğŸ‘¤</div>
          <div class="user-details">
            <h3>Welcome to Apple Music!</h3>
            <p>Please enter your full name for better UX</p>
          </div>
        </div>
        
        <div class="fullname-input-container">
          <input 
            type="text" 
            id="fullname-input" 
            class="fullname-input" 
            placeholder="Enter your full name" 
            maxlength="50"
          />
          <button id="submit-fullname-btn" class="btn btn-primary">
            <span class="btn-icon">âœ“</span>
            Continue
          </button>
        </div>
      </div>

      <div id="user-section" style="display: none;">
        <div class="section-header">
          <button id="back-to-users-btn" class="btn btn-small btn-outline" style="display: none;">
            <span class="btn-icon">â†</span> Back to Users
          </button>
        </div>
        <div class="user-info">
          <div class="avatar">ğŸ‘¤</div>
          <div class="user-details">
            <h3 id="user-name">User</h3>
            <p id="user-storefront">Storefront: --</p>
          </div>
        </div>
        
        <div class="actions">
          <button id="sync-btn" class="btn btn-secondary">
            <span class="btn-icon">ğŸ”„</span>
            Sync Profile
          </button>
          <button id="logout-btn" class="btn btn-outline">
            <span class="btn-icon">ğŸšª</span>
            Sign Out
          </button>
        </div>

        <div id="sync-status" class="status-card" style="display: none;">
          <div class="status-icon">â³</div>
          <p id="status-text">Syncing...</p>
        </div>

        <div id="profile-result" class="result-card" style="display: none;">
          <h4>Profile Summary</h4>
          <div id="profile-genres" class="genres"></div>
          <p id="profile-songs"></p>
        </div>

        <!-- Similar Users Section -->
        <div id="similarity-section" class="similarity-section" style="display: none;">
          <h4>ğŸ¯ Similar Users</h4>
          <button id="find-similar-btn" class="btn btn-secondary">
            <span class="btn-icon">ğŸ”</span>
            Find Similar Users
          </button>
          
          <div id="similarity-loading" class="status-card" style="display: none;">
            <div class="status-icon">â³</div>
            <p>Searching for similar music lovers...</p>
          </div>
          
          <div id="similarity-results" class="similarity-results" style="display: none;">
            <div id="similar-users-list"></div>
          </div>
          
          <div id="no-similar-users" class="info-card" style="display: none;">
            <p>No other users found yet. Invite friends to compare music tastes!</p>
          </div>
        </div>
      </div>

      <div id="error-section" class="error-card" style="display: none;">
        <p id="error-text"></p>
      </div>
    </div>

    <!-- User Comparison Modal -->
    <div id="comparison-modal" class="modal" style="display: none;">
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h3>ğŸµ Music Taste Comparison</h3>
        <div id="comparison-result"></div>
      </div>
    </div>

    <footer>
      <p>Powered by MusicKit JS & FastAPI</p>
    </footer>
  </div>

  <script src="https://js-cdn.music.apple.com/musickit/v3/musickit.js" data-web-components async></script>
  <script src="app.js"></script>
</body>
</html>
